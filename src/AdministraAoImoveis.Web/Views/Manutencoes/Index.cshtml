@model MaintenanceOrderListViewModel
@using AdministraAoImoveis.Web.Domain.Enumerations
@{
    ViewData["Title"] = "Ordens de Manutenção";
}
<section class="space-y-6">
    <header class="card">
        <h2 class="card-title">Ordens de Manutenção</h2>
        <p class="text-sm text-slate-500">Acompanhe solicitações, execução e conclusão das ordens de serviço.</p>
        <div class="mt-4">
            <form class="grid grid-cols-1 md:grid-cols-5 gap-3" method="get">
                <div>
                    <label class="label" for="status">Status</label>
                    <select class="input" id="status" name="status">
                        <option value="">Todos</option>
                        @foreach (var status in Enum.GetValues(typeof(MaintenanceOrderStatus)).Cast<MaintenanceOrderStatus>())
                        {
                            if (Model.Status == status)
                            {
                                <option value="@status" selected>@status</option>
                            }
                            else
                            {
                                <option value="@status">@status</option>
                            }
                        }
                    </select>
                </div>
                <div>
                    <label class="label" for="imovelId">Imóvel</label>
                    <select class="input" id="imovelId" name="imovelId">
                        <option value="">Todos</option>
                        @foreach (var option in Model.Imoveis)
                        {
                            if (option.Selected)
                            {
                                <option value="@option.Value" selected>@option.Text</option>
                            }
                            else
                            {
                                <option value="@option.Value">@option.Text</option>
                            }
                        }
                    </select>
                </div>
                <div>
                    <label class="label" for="criadaDe">Criada de</label>
                    <input class="input" type="date" id="criadaDe" name="criadaDe" value="@(Model.CriadaDe?.ToString("yyyy-MM-dd"))" />
                </div>
                <div>
                    <label class="label" for="criadaAte">Criada até</label>
                    <input class="input" type="date" id="criadaAte" name="criadaAte" value="@(Model.CriadaAte?.ToString("yyyy-MM-dd"))" />
                </div>
                <div class="flex items-end">
                    <button class="btn-primary w-full" type="submit">Filtrar</button>
                </div>
            </form>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-6">
            <div class="stat">
                <span class="stat-label">Total de ordens</span>
                <span class="stat-value">@Model.Total</span>
            </div>
            <div class="stat">
                <span class="stat-label">Em execução</span>
                <span class="stat-value text-amber-600">@Model.TotalEmExecucao</span>
            </div>
            <div class="stat">
                <span class="stat-label">Atrasadas</span>
                <span class="stat-value text-red-600">@Model.TotalAtrasadas</span>
            </div>
        </div>
        <div class="mt-6">
            <a class="btn-secondary" asp-action="Create">Nova ordem</a>
        </div>
    </header>

    <section class="card">
        <h3 class="card-title">Visão geral por status</h3>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
            @foreach (var kvp in Model.TotaisPorStatus)
            {
                <div class="p-4 bg-slate-50 rounded">
                    <div class="text-xs uppercase tracking-wide text-slate-500">@kvp.Key</div>
                    <div class="text-lg font-semibold">@kvp.Value</div>
                </div>
            }
        </div>
    </section>

    <section class="card">
        <h3 class="card-title">Ordens registradas</h3>
        @if (!Model.Itens.Any())
        {
            <p class="empty-state">Nenhuma ordem encontrada.</p>
        }
        else
        {
            <div class="overflow-x-auto">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Imóvel</th>
                            <th>Título</th>
                            <th>Status</th>
                            <th>Previsão</th>
                            <th>Custo</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Itens)
                        {
                            var statusClass = item.Status switch
                            {
                                MaintenanceOrderStatus.Solicitada => "text-blue-600",
                                MaintenanceOrderStatus.Aprovada => "text-indigo-600",
                                MaintenanceOrderStatus.EmExecucao => "text-amber-600",
                                MaintenanceOrderStatus.Concluida => "text-emerald-600",
                                MaintenanceOrderStatus.Cancelada => "text-slate-500",
                                _ => "text-slate-600"
                            };
                            <tr class="@(item.EstaAtrasada ? "bg-red-50" : string.Empty)">
                                <td>
                                    <div class="font-semibold">@item.ImovelCodigo</div>
                                    <div class="text-xs text-slate-500">@item.ImovelTitulo</div>
                                </td>
                                <td>
                                    <div class="font-semibold">@item.Titulo</div>
                                    <div class="text-xs text-slate-500">@item.Categoria</div>
                                </td>
                                <td class="@statusClass">@item.Status</td>
                                <td>@(item.PrevisaoConclusao?.ToString("dd/MM/yyyy") ?? "-")</td>
                                <td>
                                    <div>@(item.CustoReal?.ToString("C", System.Globalization.CultureInfo.GetCultureInfo("pt-BR")) ?? "-")</div>
                                    @if (item.CustoEstimado.HasValue && !item.CustoReal.HasValue)
                                    {
                                        <div class="text-xs text-slate-500">Estimado: @item.CustoEstimado.Value.ToString("C", System.Globalization.CultureInfo.GetCultureInfo("pt-BR"))</div>
                                    }
                                </td>
                                <td class="text-right">
                                    <a class="link" asp-action="Details" asp-route-id="@item.Id">detalhes</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </section>
</section>
